<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Atmosfēras spiediena grafiks</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.highcharts.com/stock/highstock.js"></script>
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/highcharts-more.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/modules/export-data.js"></script>
  <script src="https://code.highcharts.com/modules/accessibility.js"></script>

  <style>
    .temperature-chart {
      width: 100%;
      height: 100%;
    }

    .toggle-button {
      position: absolute;
      top: 10px;
      right: 88%;
      background-color: rgb(0, 40, 255);
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <div id="temperature-chart" class="temperature-chart"></div>
  <button id="toggleButton" class="toggle-button" onclick="toggleSeriesVisibility()">Paslēpt</button>
  <script>
    let seriesVisible = true;
    const colorScale = [
    "rgb(255,255,255)",
        "rgb(255,245,255)",
        "rgb(255,230,255)",
        "rgb(255,220,255)",
        "rgb(255,205,255)",
        "rgb(255,190,255)",
        "rgb(255,175,255)",
        "rgb(255,160,255)",
        "rgb(255,145,255)",
        "rgb(255,135,255)",
        "rgb(255,120,255)",
        "rgb(255,110,255)",
        "rgb(255,100,255)",
        "rgb(255,90,255)",
        "rgb(255,80,255)",
        "rgb(255,70,255)",
        "rgb(255,60,255)",
        "rgb(255,50,255)",
        "rgb(255,35,255)",
        "rgb(255,15,255)",
        "rgb(255,0,255)",
        "rgb(240,0,240)",
        "rgb(230,0,230)",
        "rgb(220,0,220)",
        "rgb(200,0,200)",
        "rgb(190,0,180)",
        "rgb(175,0,165)",
        "rgb(160,0,150)",
        "rgb(145,0,140)",
        "rgb(135,0,130)",
        "rgb(115,0,125)",
        "rgb(90,0,115)",
        "rgb(65,0,115)",
        "rgb(35,0,115)",
        "rgb(10,0,120)",
        "rgb(0,0,128)",
        "rgb(0,0,160)",
        "rgb(0,0,190)",
        "rgb(0,0,225)",
        "rgb(0,0,255)",
        "rgb(0,35,255)",
        "rgb(0,65,255)",
        "rgb(0,85,255)",
        "rgb(0,110,255)",
        "rgb(0,128,255)",
        "rgb(0,145,255)",
        "rgb(0,170,255)",
        "rgb(0,195,255)",
        "rgb(0,215,255)",
        "rgb(0,230,255)",
        "rgb(0,255,255)",
        "rgb(0,255,128)",
        "rgb(0,255,95)",
        "rgb(0,255,70)",
        "rgb(0,255,40)",
        "rgb(0,255,0)",
        "rgb(70,255,0)",
        "rgb(110,255,0)",
        "rgb(140,255,0)",
        "rgb(165,255,0)",
        "rgb(185,255,0)",
        "rgb(205,255,0)",
        "rgb(220,255,0)",
        "rgb(235,255,0)",
        "rgb(255,255,0)",
        "rgb(255,240,0)",
        "rgb(255,220,0)",
        "rgb(255,195,0)",
        "rgb(255,165,0)",
        "rgb(255,140,0)",
        "rgb(255,120,0)",
        "rgb(255,100,0)",
        "rgb(255,80,0)",
        "rgb(255,60,0)",
        "rgb(255,30,0)",
        "rgb(255,0,0)",
        "rgb(245,0,0)",
        "rgb(235,0,0)",
        "rgb(220,0,0)",
        "rgb(205,0,0)",
        "rgb(195,0,0)",
        "rgb(180,0,0)",
        "rgb(165,0,0)",
        "rgb(150,0,0)",
        "rgb(135,0,0)",
        "rgb(120,0,0)",
        "rgb(110,0,0)",
        "rgb(100,0,0)",
        "rgb(90,0,0)",
        "rgb(75,0,0)",
        "rgb(60,0,0)",
        "rgb(60,20,20)",
        "rgb(60,40,40)",
        "rgb(60,60,60)",
        "rgb(80,80,80)",
        "rgb(100,100,100)",
        "rgb(120,120,120)",
        "rgb(140,140,140)",
        "rgb(160,160,160)",
        "rgb(180,180,180)",
      // ... (add other colors as needed)
    ];

    $(document).ready(function () {
      fetchData();
    });

    function fetchData() {
      $.ajax({
        url: 'https://videscentrs.lvgmc.lv/data/weather_monitoring_data_raw',
        method: 'GET',
        dataType: 'json',
        success: processData,
        error: function (error) {
          console.error('Failed to fetch data:', error);
        }
      });
    }

    function processData(data) {
      const stationNameMapping = {
        "DAUGAVGR": "Daugavgrīva",
        "KALNCIEM": "Kalnciems",
        "KULDIGA": "Kuldīga",
        "LIELPECI": "Lielpeči",
        "PIEDRUJA": "Piedruja",
        "RIAI99PA": "Ainaži",
        "RIAL99MS": "Alūksne",
        "RIBA99PA": "Bauska",
        "RIDAGDA": "Dagda",
        "RIDM99MS": "Daugavpils",
        "RIDO99MS": "Dobele",
        "RIGASLU": "Rīga (LU)",
        "RIGU99MS": "Gulbene",
        "RIJE99PA": "Jelgava",
        "RIKO99PA": "Kolka",
        "RILP99PA": "Liepāja",
        "RIMADONA": "Madona",
        "RIME99MS": "Mērsrags",
        "RIPA99PA": "Pāvilosta",
        "RIPR99PA": "Priekuļi",
        "RIREZEKN": "Rēzekne",
        "RIRU99PA": "Rūjiena",
        "RISA99PA": "Saldus",
        "RISE99MS": "Skulte",
        "RISI99PA": "Skrīveri",
        "RIST99PA": "Stende",
        "RIVE99PA": "Ventspils",
        "RIZI99PA": "Zīlāni",
        "RIZO99MS": "Zosēni",
        "RUCAVA": "Rucava",
        "SIGULDA": "Sigulda",
        "SILI": "Sīļi",
        "VICAKI": "Vičaki",
        // Add more mappings as needed
      };

      const stationNames = [...new Set(data.map((entry) => entry.stacijas_kods))];

      const seriesData = stationNames.map((station) => ({
        name: stationNameMapping[station] || station,
        data: data
          .filter((entry) => entry.stacijas_kods === station)
          .map((entry) => [new Date(entry.laiks).getTime(), parseFloat(entry.atmosferas_spiediens)]),
      }));

      initializeChart(seriesData);
    }

    function initializeChart(seriesData) {
      // Common styles for the chart
      const commonStyles = {
        backgroundColor: 'transparent',
        height: 641,
      };

      // Common styles for axis
      const axisStyles = {
        labels: {
          style: {
            color: 'rgb(250, 252, 255)',
          }
        },
        lineColor: 'rgb(250, 252, 255)',
        gridLineColor: 'rgba(255, 255, 255, 0.2)',
      };

      Highcharts.chart("temperature-chart", {
        chart: {
          type: "line",
          ...commonStyles,
        },
        exporting: {
          enabled: true,
          buttons: {
            contextButton: {
              menuItems: [
                "viewFullscreen",
                "printChart",
                "downloadPNG",
                "downloadJPEG",
                "downloadPDF",
                "downloadSVG",
              ],
            },
          },
        },
        title: {
          text: "Atmosfēras spiediens",
          style: {
            color: 'rgb(250, 252, 255)',
          }
        },
        plotOptions: {
          line: {
            marker: {
              enabled: false,
            },
            lineWidth: 5, // Set the desired line width here
          }
        },
        xAxis: {
          type: "datetime",
          title: {
            text: "Laiks",
            style: {
              color: 'rgb(250, 252, 255)',
            }
          },
          lineColor: 'rgb(250, 252, 255)',
          gridLineWidth: 1,  // Width of the grid lines
          gridLineColor: 'rgba(255, 255, 255, 0.2)',  // Color of the grid lines
        },
        yAxis: {
          title: {
            text: "Atmosfēras spiediens (hPa)",
            style: {
              color: 'rgb(250, 252, 255)',
            }
          },
          ...axisStyles,
          plotLines: [{
            value: 0,
            color: 'rgba(255, 255, 255, 1.0)',
            width: 3,
            zIndex: 1,
          }],
        },
        series: seriesData.map((entry, index) => ({
          ...entry,
          zones: generateColorZones(colorScale, index),
        })),
        navigator: {
          enabled: true,
          adaptToUpdatedData: true,
          xAxis: {
            lineColor: 'rgb(250, 252, 255)',
            gridLineWidth: 1,  // Width of the grid lines
            gridLineColor: 'rgba(255, 255, 255, 0.2)',  // Color of the grid lines,
          },
          maskFill: 'rgba(255, 255, 255, 0.1)',
          series: {
            color: 'rgba(255, 255, 255, 0.5)',
          },
          handles: {
            backgroundColor: 'rgba(255, 255, 255, 0.8)',
            borderColor: 'rgb(250, 252, 255)',
          },
          outlineColor: 'rgb(250, 252, 255)',
        },
        legend: {
          layout: "horizontal",
          align: "center",
          verticalAlign: "bottom",
          enabled: true,
          itemStyle: {
            color: 'rgb(250, 252, 255)',
          },
        },
        tooltip: {
          formatter: function () {
            const date = new Date(this.x);
            const formattedDate = `${padZero(date.getDate())}.${padZero(date.getMonth() + 1)}.${date.getFullYear()} ${padZero(date.getHours())}:${padZero(date.getMinutes())}`;
            return `<b>${formattedDate}</b><br/>${this.series.name}: ${this.y} hPa`;
          }
        }
      });
    }

    function generateColorZones(colorScale, index) {
      // Sample color zones, replace with your logic
      return [{
        value: 950,
        color: colorScale[1],
      }, {
        value: 951,
        color: colorScale[2],
      }, {
        value: 952,
        color: colorScale[3],
      }, {
        value: 953,
        color: colorScale[4],
      }, {
        value: 954,
        color: colorScale[5],
      }, {
        value: 955,
        color: colorScale[6],
      }, {
        value: 956,
        color: colorScale[7],
      }, {
        value: 957,
        color: colorScale[8],
      }, {
        value: 958,
        color: colorScale[9],
      }, {
        value: 959,
        color: colorScale[10],
      }, {
        value: 960,
        color: colorScale[11],
      }, {
        value: 961,
        color: colorScale[12],
      }, {
        value: 962,
        color: colorScale[13],
      }, {
        value: 963,
        color: colorScale[14],
      }, {
        value: 964,
        color: colorScale[15],
      }, {
        value: 965,
        color: colorScale[16],
      }, {
        value: 966,
        color: colorScale[17],
      }, {
        value: 967,
        color: colorScale[18],
      }, {
        value: 968,
        color: colorScale[19],
      }, {
        value: 969,
        color: colorScale[20],
      }, {
        value: 970,
        color: colorScale[21],
      }, {
        value: 971,
        color: colorScale[22],
      }, {
        value: 972,
        color: colorScale[23],
      }, {
        value: 973,
        color: colorScale[24],
      }, {
        value: 974,
        color: colorScale[25],
      }, {
        value: 975,
        color: colorScale[26],
      }, {
        value: 976,
        color: colorScale[27],
      }, {
        value: 977,
        color: colorScale[28],
      }, {
        value: 978,
        color: colorScale[29],
      }, {
        value: 979,
        color: colorScale[30],
      }, {
        value: 980,
        color: colorScale[31],
      }, {
        value: 981,
        color: colorScale[32],
      }, {
        value: 982,
        color: colorScale[33],
      }, {
        value: 983,
        color: colorScale[34],
      }, {
        value: 984,
        color: colorScale[35],
      }, {
        value: 985,
        color: colorScale[36],
      }, {
        value: 986,
        color: colorScale[37],
      }, {
        value: 987,
        color: colorScale[38],
      }, {
        value: 988,
        color: colorScale[39],
      }, {
        value: 989,
        color: colorScale[40],
      }, {
        value: 990,
        color: colorScale[41],
      }, {
        value: 991,
        color: colorScale[42],
      }, {
        value: 992,
        color: colorScale[43],
      }, {
        value: 993,
        color: colorScale[44],
      }, {
        value: 994,
        color: colorScale[45],
      }, {
        value: 995,
        color: colorScale[46],
      }, {
        value: 996,
        color: colorScale[47],
      }, {
        value: 997,
        color: colorScale[48],
      }, {
        value: 998,
        color: colorScale[49],
      }, {
        value: 999,
        color: colorScale[50],
      }, {
        value: 1000,
        color: colorScale[51],
      }, {
        value: 1001,
        color: colorScale[52],
      }, {
        value: 1002,
        color: colorScale[53],
      }, {
        value: 1003,
        color: colorScale[54],
      }, {
        value: 1004,
        color: colorScale[55],
      }, {
        value: 1005,
        color: colorScale[56],
      }, {
        value: 1006,
        color: colorScale[57],
      }, {
        value: 1007,
        color: colorScale[58],
      }, {
        value: 1008,
        color: colorScale[59],
      }, {
        value: 1009,
        color: colorScale[60],
      }, {
        value: 1010,
        color: colorScale[61],
      }, {
        value: 1011,
        color: colorScale[62],
      }, {
        value: 1012,
        color: colorScale[63],
      }, {
        value: 1013,
        color: colorScale[64],
      }, {
        value: 1014,
        color: colorScale[65],
      }, {
        value: 1015,
        color: colorScale[66],
      }, {
        value: 1016,
        color: colorScale[67],
      }, {
        value: 1017,
        color: colorScale[68],
      }, {
        value: 1018,
        color: colorScale[69],
      }, {
        value: 1019,
        color: colorScale[70],
      }, {
        value: 1020,
        color: colorScale[71],
      }, {
        value: 1021,
        color: colorScale[72],
      }, {
        value: 1022,
        color: colorScale[73],
      }, {
        value: 1023,
        color: colorScale[74],
      }, {
        value: 1024,
        color: colorScale[75],
      }, {
        value: 1025,
        color: colorScale[76],
      }, {
        value: 1026,
        color: colorScale[77],
      }, {
        value: 1027,
        color: colorScale[78],
      },{
        value: 1028,
        color: colorScale[79],
      }, {
        value: 1029,
        color: colorScale[80],
      }, {
        value: 1030,
        color: colorScale[81],
      }, {
        value: 1031,
        color: colorScale[82],
      }, {
        value: 1032,
        color: colorScale[83],
      }, {
        value: 1033,
        color: colorScale[84],
      }, {
        value: 1034,
        color: colorScale[85],
      }, {
        value: 1035,
        color: colorScale[86],
      }, {
        value: 1036,
        color: colorScale[87],
      }, {
        value: 1037,
        color: colorScale[88],
      }, {
        value: 1038,
        color: colorScale[89],
      }, {
        value: 1039,
        color: colorScale[90],
      }, {
        value: 1040,
        color: colorScale[91],
      }, {
        value: 1041,
        color: colorScale[92],
      }, {
        value: 1042,
        color: colorScale[93],
      }, {
        value: 1043,
        color: colorScale[94],
      }, {
        value: 1044,
        color: colorScale[95],
      }, {
        value: 1045,
        color: colorScale[96],
      }, {
        value: 1046,
        color: colorScale[97],
      }, {
        value: 1047,
        color: colorScale[98],
      }, {
        value: 1048,
        color: colorScale[99],
      }, {
        value: 1049,
        color: colorScale[100],
      }, {
      }];
    }
    function toggleSeriesVisibility() {
      const chart = Highcharts.charts[0]; // Assuming you have only one chart on the page

      chart.series.forEach((series) => {
        const newVisibility = !series.visible;
        series.setVisible(newVisibility, false);
      });

      chart.redraw(); // Redraw the chart after updating series visibility
    }

    function padZero(num) {
      return num < 10 ? `0${num}` : num;
    }
  </script>
</body>

</html>